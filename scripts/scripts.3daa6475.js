"use strict";angular.module("angularEcsFlapApp",["ngAnimate","ngRoute","ngSanitize","ngTouch","ngCookies","hc.ngEcs","ngEcs.dom","ngEcs.FPSMeter"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]).factory("isMobile",["$window",function(a){return a.innerWidth<768}]),angular.module("ngEcs.dom",["hc.ngEcs"]).config(["$componentsProvider",function(a){a.register("dom",function(){function a(a){this.selector=a||null,angular.isString(a)&&"<"!=a.charAt(0)&&(a=document.querySelector(a)),angular.element.call(this,a),this.$cachedStyle={}}a.$inject=["selector"],a.prototype=Object.create(angular.element.prototype),a.prototype.element=a,a.prototype.cachedCss=function(a,b){this.$cachedStyle[a]!==b&&(this[0].style[a]=b,this.$cachedStyle[a]=b)};var b=["-moz-","-webkit-","-o-","-ms-",""];return a.prototype.prefixedCss=function(a,c){if(this.$cachedStyle[a]!==c)for(var d=this[0].style,e=0;5>e;e++)d[b[e]+a]=c;return this},a.prototype.transform=function(a,b,c){return"string"==typeof a?this.prefixedCss("transform",a):(a=~~a||0,b=~~b||0,c=~~c||0,this.prefixedCss("transform","translate3d("+a+"px,"+b+"px,"+c+"px)"))},a})}]),angular.module("angularEcsFlapApp").run(["ngEcs",function(a){function b(){this.width=this.height=0,this.top=this.right=this.bottom=this.left=0}Victor.$inject=["x","y"],a.$c("position",Victor),a.$c("velocity",Victor),a.$c("acc",Victor),a.$c("scroll",Victor),b.prototype.update=function(a){this.top=a.y,this.left=a.x,this.right=a.x+this.width,this.bottom=a.y+this.height,this.margin&&(this.top+=this.margin.top||0,this.bottom-=this.margin.bottom||0)},b.prototype.overlapY=function(a){return Math.max(0,Math.min(this.bottom,a.bottom)-Math.max(this.top,a.top))},b.prototype.overlapX=function(a){return Math.max(0,Math.min(this.right,a.right)-Math.max(this.left,a.left))},a.$c("bbox",b)}]),angular.module("ngEcs.FPSMeter",["hc.ngEcs"]).run(["ngEcs","$document",function(a,b){function c(){a.updated.add(e,null,1e3),a.updated.add(f,null,-1),a.rendered.add(g,null,1e3),a.rendered.add(h,null,-1e3)}function d(){a.updated.remove(e,null),a.updated.remove(f,null),a.rendered.remove(g,null),a.rendered.remove(h,null)}function e(){i("update").start()}function f(){i("update").end()}function g(){i("render").start(),i("rAF").tick()}function h(){i("fps").frame(),i("render").end(),i().update()}var i=rStats({values:{raf:{caption:"Time since last rAF (ms)"},fps:{caption:"Framerate (FPS)",below:30},update:{caption:"Update (ms)"},render:{caption:"Render (ms)"}},groups:[{caption:"Framerate",values:["fps","raf"]},{caption:"Frame Budget",values:["update","render"]}]}),j=angular.element(document.querySelector(".rs-base"));j.addClass("ng-hide");var k=!1;b.on("keypress",function(a){126===a.which&&(k?(k=!1,j.addClass("ng-hide"),d()):(k=!0,j.removeClass("ng-hide"),c()))})}]),angular.module("angularEcsFlapApp").run(["$window","$document","$cookies","ngEcs","assemblies","isMobile",function(a,b,c,d,e,f){function g(a){return 180*a/Math.PI}var h=400;d.$s("controls",{keys:{},$require:["control","velocity"],changeKey:function(a,b){this.keys[a.keyCode]=b},$added:function(){var a=this;b.on("keydown",function(b){a.changeKey(b||window.event,!0)}).on("keyup",function(b){a.changeKey(b||window.event,!1)}).on("mousedown touchstart",function(){a.mousedown=!0}).on("mousemove mouseup touchend touchcancel",function(){a.mousedown=!1})},$started:function(){this.disabled=!1},$updateEach:function(a){(this.keys[32]||this.mousedown)&&(a.velocity.y=-h)}}),d.$s("acceleration",{$require:["acc","velocity"],$updateEach:function(a,b){a.velocity.x+=a.acc.x*b,a.velocity.y+=a.acc.y*b}}),d.$s("velocity",{$require:["position","velocity"],$updateEach:function(a,b){a.position.x+=a.velocity.x*b,a.position.y+=a.velocity.y*b}}),d.$s("scroll",{$require:["scroll","position"],$updateEach:function(a,b){a.position.x%=a.scroll.x}}),d.$s("position",{$require:["position","dom","velocity"],$addEntity:function(a){var b=d.entities.canvas.dom,c=a.dom;a.position.x=c.prop("offsetLeft")-b.prop("offsetLeft"),a.position.y=c.prop("offsetTop")-b.prop("offsetTop")},getTranslation:function(a){var b="translate3d("+~~a.position.x+"px, "+~~a.position.y+"px, 0)";if("bird"===a._id){var c=-a.velocity.y/h,d=Math.max(c,-1),e=Math.max(c,-.5);b=b+" rotateZ("+g(Math.acos(d))+"deg) rotateY("+g(Math.asin(e))+"deg)"}return b},$started:function(){var a=this;this.$family.forEach(function(b){var c=b.dom,d=c.prop("offsetWidth"),e=c.prop("offsetHeight");c.css({top:0,left:0,right:"auto",bottom:"auto",padding:0,margin:0,width:d+"px",height:e+"px",position:"absolute"}),b.dom.transform(a.getTranslation(b))})},$renderEach:function(a){a.dom.transform(this.getTranslation(a))}}),d.$s("pipes",{$require:["pipe"],screen:null,$started:function(){for(var a=this.screen=d.entities.canvas,b=a.bbox.width/4,c=a.bbox.height;this.$family.length<5;){var f=new d.components.dom('<img class="pipe" src="images/cat.png"></img>');a.dom.append(f),d.$e(angular.copy(e.pipe)).$add("dom",f)}d.systems.bbox.$started(),this.$family.forEach(function(d,e){d.position.x=a.bbox.width+e*b,d.position.y=c/2*Math.random(),d.pipe.cleared=!1})}}),d.$s("bbox",{$require:["dom","bbox"],$addEntity:function(a){var b=a.dom;a.bbox.width=b.prop("offsetWidth"),a.bbox.height=b.prop("offsetHeight"),a.bbox.update({x:0,y:0})},$started:function(){this.$family.forEach(function(a){a.dom.css({width:a.bbox.width+"px",height:a.bbox.height+"px",padding:0,margin:0})})},$updateEach:function(a){a.position&&a.bbox.update(a.position)}}),d.$s("collision",{score:0,hiscore:0,screen:null,bird:null,pipes:null,miss:!1,hit:!1,crash:!1,startPos:null,time:0,$require:["bird"],$started:function(){this.hiscore=c.hiscore||0,this.screen=d.entities.canvas,this.pipes=d.$f(["pipe"]);var a=this.$family[0];a.$add("control",!0),this.startPos?(a.position.x=this.startPos.x,a.position.y=this.startPos.y):(this.startPos={},this.startPos.x=a.position.x,this.startPos.y=a.position.y),a.velocity.y=0,this.time=0,this.score=0,this.miss=!1,this.crash=!1,this.screen.dom.removeClass("crash")},$updateEach:function(a,b){this.time+=b;var c=this.screen.bbox,d=a.bbox;if(d.bottom>c.bottom&&(a.position.y=c.bottom-d.height,this.crash=!0),!this.crash&&!this.miss)for(var e,f,g=this.pipes,h=g.length;h--;)e=g[h],f=e.bbox,e.pipe.cleared?f.right<c.left-c.width/8&&(e.position.x=9*c.width/8,e.pipe.cleared=!1):f.right<d.left?(e.pipe.cleared=!0,this.score++):f.left<d.right&&(d.top<f.top||d.bottom>f.bottom)&&(this.miss=!0,a.$remove("control"))},$render:function(){(this.miss||this.crash)&&(this.screen.dom.addClass("crash"),this.crash&&d.$stop()),this.score>this.hiscore&&(this.hiscore=this.score)},$stopped:function(){c.hiscore=this.hiscore}})}]),angular.module("angularEcsFlapApp").constant("assemblies",{canvas:{dom:{selector:"#canvas"},bbox:{margin:{bottom:0}}},pipe:{velocity:{x:-200,y:0},position:{x:0,y:0},pipe:{cleared:!1},bbox:{margin:{top:50,bottom:50}}},bird:{dom:{selector:"#bird"},bbox:{},velocity:{x:0,y:0},acc:{x:0,y:2e3},position:{x:0,y:0},control:!0,bird:!0}}),angular.module("angularEcsFlapApp").controller("MainCtrl",["$window","$document","$scope","$route","ngEcs","assemblies","isMobile",function(a,b,c,d,e,f,g){function h(){var a=k.offsetWidth/j.prop("offsetWidth");j.prefixedCss("transform-origin","0 0").transform("translate3d(0,0,0) scale3d("+a+","+a+",1)");var b=j.prop("offsetHeight");k.style.height=b*a+"px"}var i=this;i.game=e,e.$fps=g?45:60,i.message=function(){return i.game.$playing?i.game.systems.collision.score:"angular-ecs-flap"},i.hiscore=function(){return i.game.systems.collision.hiscore>0?"High Score: "+i.game.systems.collision.hiscore:"Built using AngularJS and angular-ecs"},i.click=function(a){a.target.blur(),e.$start()};var j=e.$e("canvas",f.canvas).dom;e.$e("bird",f.bird),e.$e({dom:{selector:".canvas-bg"},velocity:{x:-100,y:0},position:{},scroll:{x:2061}}),e.$e({dom:{selector:".canvas-bg-clouds"},velocity:{x:-50,y:0},position:{},scroll:{x:2061}}),b.on("keydown",function(a){e.$playing||32!==a.keyCode||e.$start()});var k=document.querySelector("#container");h(),a.addEventListener("resize",h,!1)}]),angular.module("angularEcsFlapApp").controller("AboutCtrl",function(){});